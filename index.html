<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entity Formation Engine | v1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700&family=Cormorant+Garamond:wght@600;700&family=Source+Serif+4:wght@400;500;600&display=swap');

        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Custom scrollbar for the preview pane */
        .preview-pane::-webkit-scrollbar { width: 8px; }
        .preview-pane::-webkit-scrollbar-track { background: #1e293b; }
        .preview-pane::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .preview-pane::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .input-group { margin-bottom: 1.5rem; }
        .input-label { display: block; font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 0.5rem; letter-spacing: 0.05em; }
        .input-field { width: 100%; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.375rem; padding: 0.75rem; font-size: 0.875rem; color: #1e293b; transition: all 0.2s; }
        .input-field:focus { outline: none; border-color: #3b82f6; background: #fff; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }

        /* Legal stationery inspired preview */
        .doc-preview {
            font-family: 'Source Serif 4', serif;
            line-height: 1.7;
            color: #1f2937;
            padding: 3rem 3.5rem 3rem 3.5rem;
            background: #fdfaf5;
            min-height: 100%;
            position: relative;
            border: 1px solid #e2dcc8;
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }

        .doc-heading {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.75rem;
            text-align: center;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            margin: 1rem 0 0.5rem;
        }

        .doc-subheading {
            font-size: 0.95rem;
            text-align: center;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #6b7280;
            margin-bottom: 1.25rem;
        }

        .letterhead {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #d7c7a3;
        }

        .letterhead-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-mark {
            width: 44px;
            height: 44px;
            border: 2px solid #bfa76a;
            border-radius: 9999px;
            display: grid;
            place-items: center;
            font-family: 'Cormorant Garamond', serif;
            font-weight: 700;
            color: #bfa76a;
            letter-spacing: 0.08em;
        }

        .letterhead-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.25rem;
            letter-spacing: 0.05em;
        }

        .letterhead-subtitle {
            font-size: 0.9rem;
            color: #6b7280;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .letterhead-meta {
            text-align: right;
            font-size: 0.85rem;
            color: #6b7280;
            line-height: 1.4;
        }

        .watermark {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            pointer-events: none;
            opacity: 0.05;
            font-family: 'Cormorant Garamond', serif;
            font-size: 4.5rem;
            letter-spacing: 0.2em;
            color: #bfa76a;
            transform: rotate(-18deg);
        }

        .doc-body {
            position: relative;
            margin-top: 1.5rem;
        }

        .divider {
            border-bottom: 1px solid #d7c7a3;
            margin: 0.75rem 0 1.5rem;
        }

        .section-list {
            counter-reset: section;
            display: grid;
            gap: 1.2rem;
        }

        .numbered-section {
            counter-increment: section;
            padding-left: 2.25rem;
            position: relative;
        }

        .numbered-section::before {
            content: counter(section) '.';
            position: absolute;
            left: 0;
            top: 0.2rem;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.15rem;
            font-weight: 700;
            color: #bfa76a;
        }

        .section-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.05rem;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            margin-bottom: 0.35rem;
        }

        .section-body {
            font-size: 0.98rem;
            color: #1f2937;
        }

        .signature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.25rem;
            margin-top: 1.75rem;
        }

        .signature-line {
            border-top: 1px solid #c4b58f;
            padding-top: 0.55rem;
            font-size: 0.9rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #374151;
        }

        .muted {
            color: #6b7280;
        }

        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #3b82f6; }
        .toggle-checkbox:checked + .toggle-label { background-color: #3b82f6; }
    </style>
</head>
<body class="bg-slate-100 h-screen flex flex-col overflow-hidden">

    <!-- Top Bar -->
    <header class="bg-slate-900 text-white h-14 flex items-center justify-between px-6 flex-shrink-0 z-10 shadow-md">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-cube text-blue-500"></i>
            <span class="font-bold tracking-wide text-sm">ENTITY FORMATION ENGINE</span>
            <span class="bg-slate-800 text-xs px-2 py-0.5 rounded text-slate-400 mono">v1.0.4</span>
        </div>
        <div class="flex items-center gap-4">
            <button onclick="resetForm()" class="text-xs text-slate-400 hover:text-white transition">Reset</button>
            <button onclick="downloadAll()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1.5 rounded text-sm font-medium transition flex items-center gap-2">
                <i class="fa-solid fa-download"></i> Download Package (.zip)
            </button>
        </div>
    </header>

    <!-- Main Workspace -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Left Panel: Input -->
        <div class="w-1/2 flex flex-col border-r border-slate-200 bg-white">
            <!-- Tabs -->
            <div class="flex border-b border-slate-200 bg-slate-50">
                <button class="px-6 py-3 text-sm font-medium text-blue-600 border-b-2 border-blue-600 bg-white" onclick="switchTab('input', this)">Input Data</button>
                <button class="px-6 py-3 text-sm font-medium text-slate-500 hover:text-slate-700" onclick="switchTab('config', this)">Configuration</button>
            </div>

            <!-- Scrollable Form Area -->
            <div class="flex-1 overflow-y-auto p-8">
                <form id="entityForm" oninput="updatePreview()">
                    
                    <!-- Section 1: Entity Structure -->
                    <div class="mb-8">
                        <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-4 border-b pb-2 flex items-center gap-2">
                            <i class="fa-solid fa-building text-slate-400"></i> Structure
                        </h2>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="input-group">
                                <label class="input-label">Entity Type</label>
                                <select id="entityType" class="input-field" onchange="toggleEntityFields()">
                                    <option value="LLC">Limited Liability Company (LLC)</option>
                                    <option value="CORP">Corporation (Inc.)</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label class="input-label">State of Formation</label>
                                <input type="text" id="state" class="input-field" placeholder="e.g. Delaware">
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Entity Name</label>
                            <input type="text" id="entityName" class="input-field" placeholder="e.g. Ironclad Holdings">
                        </div>
                    </div>

                    <!-- Section 2: Management & Ownership -->
                    <div class="mb-8">
                        <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-4 border-b pb-2 flex items-center gap-2">
                            <i class="fa-solid fa-users text-slate-400"></i> Ownership
                        </h2>

                        <!-- Dynamic List Container -->
                        <div id="membersContainer" class="space-y-3 mb-4">
                            <!-- JS will populate rows here -->
                        </div>
                        
                        <button type="button" onclick="addMemberRow()" class="text-xs text-blue-600 hover:text-blue-800 font-bold uppercase tracking-wide flex items-center gap-1">
                            <i class="fa-solid fa-plus"></i> Add <span id="addLabel">Member</span>
                        </button>

                        <div class="mt-6 grid grid-cols-2 gap-4">
                             <div class="input-group">
                                <label class="input-label" id="mgmtLabel">Management</label>
                                <select id="managementType" class="input-field">
                                    <option value="Member-Managed">Member-Managed</option>
                                    <option value="Manager-Managed">Manager-Managed</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Section 3: Registered Agent -->
                    <div class="mb-8">
                        <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-4 border-b pb-2 flex items-center gap-2">
                            <i class="fa-solid fa-shield-halved text-slate-400"></i> Registered Agent
                        </h2>
                        <div class="input-group">
                            <label class="input-label">Agent Name</label>
                            <input type="text" id="agentName" class="input-field" placeholder="Full Legal Name or Commercial Agent">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Physical Address (No PO Boxes)</label>
                            <input type="text" id="agentAddress" class="input-field" placeholder="Street, City, Zip">
                        </div>
                    </div>

                    <!-- Section 4: Banking & Tax -->
                    <div class="mb-8">
                        <h2 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-4 border-b pb-2 flex items-center gap-2">
                            <i class="fa-solid fa-money-check-dollar text-slate-400"></i> Banking & Tax
                        </h2>
                        <div class="input-group">
                            <label class="input-label">Fiscal Year End</label>
                            <select id="fiscalYear" class="input-field">
                                <option value="December 31">Calendar Year (Dec 31)</option>
                                <option value="June 30">Fiscal Year (Jun 30)</option>
                                <option value="September 30">Fiscal Year (Sep 30)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Bank Name (For Resolution)</label>
                            <input type="text" id="bankName" class="input-field" placeholder="e.g. Chase, Wells Fargo, Mercury">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Initial Capital Contribution ($)</label>
                            <input type="number" id="capital" class="input-field" value="1000">
                        </div>
                    </div>

                </form>
            </div>
        </div>

        <!-- Right Panel: Live Preview -->
        <div class="w-1/2 flex flex-col bg-slate-800 border-l border-slate-700">
            <!-- Preview Controls -->
            <div class="bg-slate-900 p-2 flex gap-2 overflow-x-auto no-scrollbar border-b border-slate-700">
                <button onclick="setPreview('articles')" id="btn-articles" class="preview-tab px-3 py-2 text-xs font-mono text-white bg-slate-700 rounded transition">ARTICLES</button>
                <button onclick="setPreview('bylaws')" id="btn-bylaws" class="preview-tab px-3 py-2 text-xs font-mono text-slate-400 hover:text-white transition">GOVERNANCE</button>
                <button onclick="setPreview('ein')" id="btn-ein" class="preview-tab px-3 py-2 text-xs font-mono text-slate-400 hover:text-white transition">SS-4 INFO</button>
                <button onclick="setPreview('banking')" id="btn-banking" class="preview-tab px-3 py-2 text-xs font-mono text-slate-400 hover:text-white transition">BANKING RES</button>
            </div>

            <!-- Preview Pane -->
            <div class="preview-pane flex-1 overflow-y-auto p-8 bg-slate-300">
                <div id="docPreviewCanvas" class="doc-preview shadow-2xl mx-auto max-w-2xl text-sm">
                    <!-- Content injected via JS -->
                </div>
            </div>
            
            <!-- Footer Status -->
            <div class="bg-slate-900 text-slate-500 text-xs px-4 py-2 flex justify-between font-mono">
                <span id="statusIndicator">SYSTEM READY</span>
                <span>AUTO-SAVE: ENABLED</span>
            </div>
        </div>

    </div>

    <!-- Logic Engine -->
    <script>
        // --- State Management ---
        const state = {
            currentDoc: 'articles',
            data: {
                members: [{ name: '', percent: '' }]
            }
        };

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            loadLocal();
            addMemberRow(); // Add initial row if empty
            toggleEntityFields(); // Set initial labels
            updatePreview();
        });

        // --- Input Handling ---
        function addMemberRow() {
            const container = document.getElementById('membersContainer');
            const index = container.children.length;
            
            const div = document.createElement('div');
            div.className = "flex gap-2 items-center";
            div.innerHTML = `
                <input type="text" class="input-field member-name" placeholder="Name" oninput="updatePreview()">
                <input type="text" class="input-field w-24 member-percent" placeholder="%" oninput="updatePreview()">
                <button type="button" onclick="this.parentElement.remove(); updatePreview()" class="text-slate-400 hover:text-red-500 px-2">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            `;
            container.appendChild(div);
        }

        function toggleEntityFields() {
            const type = document.getElementById('entityType').value;
            const isLLC = type === 'LLC';

            // Update Labels
            document.getElementById('addLabel').innerText = isLLC ? 'Member' : 'Shareholder';
            document.getElementById('mgmtLabel').innerText = isLLC ? 'Management Structure' : 'Directors Structure';
            
            // Update Select Options for Corp
            const mgmtSelect = document.getElementById('managementType');
            mgmtSelect.innerHTML = '';
            if (isLLC) {
                mgmtSelect.add(new Option('Member-Managed', 'Member-Managed'));
                mgmtSelect.add(new Option('Manager-Managed', 'Manager-Managed'));
            } else {
                mgmtSelect.add(new Option('Board of Directors', 'Board of Directors'));
                mgmtSelect.add(new Option('Shareholder-Managed', 'Shareholder-Managed'));
            }

            updatePreview();
        }

        function getFormData() {
            const members = Array.from(document.querySelectorAll('#membersContainer > div')).map(row => ({
                name: row.querySelector('.member-name').value,
                percent: row.querySelector('.member-percent').value
            })).filter(m => m.name); // Filter empty

            return {
                type: document.getElementById('entityType').value,
                state: document.getElementById('state').value || '[STATE]',
                name: document.getElementById('entityName').value || '[ENTITY NAME]',
                agentName: document.getElementById('agentName').value || '[AGENT NAME]',
                agentAddress: document.getElementById('agentAddress').value || '[AGENT ADDRESS]',
                management: document.getElementById('managementType').value,
                fiscalYear: document.getElementById('fiscalYear').value,
                bank: document.getElementById('bankName').value || '[BANK NAME]',
                capital: document.getElementById('capital').value || '0',
                members: members.length ? members : [{name: '[NAME]', percent: '100'}]
            };
        }

        // --- Document Factory ---
        function buildSectionList(sections) {
            return `
                <div class="section-list">
                    ${sections.map(section => `
                        <div class="numbered-section">
                            <div class="section-title">${section.title}</div>
                            <div class="section-body">${section.body}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function buildDocShell({ heading, subheading, meta, sections, signatures }) {
            return `
                <div class="doc-body">
                    <div class="watermark">BusinessBox</div>
                    <div class="letterhead">
                        <div class="letterhead-logo">
                            <div class="logo-mark">BB</div>
                            <div>
                                <div class="letterhead-title">${subheading}</div>
                                <div class="letterhead-subtitle">${heading}</div>
                            </div>
                        </div>
                        <div class="letterhead-meta">
                            ${meta.join('<br>')}
                        </div>
                    </div>
                    <h1 class="doc-heading">${heading}</h1>
                    <div class="doc-subheading">${subheading}</div>
                    <div class="divider"></div>
                    ${buildSectionList(sections)}
                    ${signatures?.length ? `<div class="signature-grid">${signatures.map(sig => `<div class="signature-line">${sig}</div>`).join('')}</div>` : ''}
                </div>
            `;
        }

        function generateDoc(type, data) {
            const isLLC = data.type === 'LLC';
            const entityFullName = `${data.name}, ${isLLC ? 'LLC' : 'Inc.'}`;
            const govDocName = isLLC ? 'Operating Agreement' : 'Bylaws';
            const ownerTitle = isLLC ? 'Member' : 'Shareholder';
            const today = new Date().toLocaleDateString();

            switch(type) {
                case 'articles': {
                    return buildDocShell({
                        heading: isLLC ? 'Articles of Organization' : 'Articles of Incorporation',
                        subheading: entityFullName,
                        meta: [
                            `Prepared: ${today}`,
                            `Jurisdiction: ${data.state}`,
                            `Filing Code: ${isLLC ? 'LLC-ORG' : 'CORP-INC'}`
                        ],
                        sections: [
                            {
                                title: 'Name',
                                body: `The name of the ${isLLC ? 'limited liability company' : 'corporation'} is ${entityFullName}.`
                            },
                            {
                                title: 'Registered Agent',
                                body: `Service of process shall be maintained at ${data.agentAddress} under the authority of ${data.agentName}.`
                            },
                            {
                                title: 'Management',
                                body: `${isLLC ? 'The Company shall be managed' : 'The Corporation shall be governed'} by ${data.management}.`
                            },
                            {
                                title: 'Duration',
                                body: 'The entity shall exist perpetually unless dissolved pursuant to applicable law and governing agreements.'
                            },
                            {
                                title: 'Purpose',
                                body: 'To engage in any lawful business for which entities may be organized in the chosen jurisdiction.'
                            }
                        ],
                        signatures: [
                            'Organizer Signature',
                            `Date: ${today}`
                        ]
                    });
                }

                case 'bylaws': {
                    const memberListHtml = data.members.map(m => `<div>${m.name} — ${m.percent}% ${ownerTitle} interest</div>`).join('');

                    return buildDocShell({
                        heading: govDocName,
                        subheading: entityFullName,
                        meta: [
                            `Governing Body: ${isLLC ? 'Members' : 'Board of Directors'}`,
                            `Capitalization: $${data.capital}`,
                            `Fiscal Year End: ${data.fiscalYear}`
                        ],
                        sections: [
                            {
                                title: 'Formation & Authority',
                                body: `Adopted by the ${ownerTitle}s as the governing document for ${entityFullName}, organized in ${data.state}.`
                            },
                            {
                                title: 'Ownership Structure',
                                body: `The initial ${ownerTitle}s and their interests are:<br>${memberListHtml}`
                            },
                            {
                                title: 'Capital Contributions',
                                body: `Total initial capital contribution acknowledged as $${data.capital}.`
                            },
                            {
                                title: 'Banking Authority',
                                body: `All funds shall be deposited in the name of the entity, with disbursements requiring authorization from the ${data.management}.`
                            },
                            {
                                title: 'Fiscal Year & Records',
                                body: `The fiscal year ends on ${data.fiscalYear}. Books and records shall be maintained in accordance with generally accepted standards.`
                            }
                        ],
                        signatures: [
                            `${ownerTitle} Acknowledgement`,
                            'Authorized Signatory'
                        ]
                    });
                }

                case 'ein': {
                    return buildDocShell({
                        heading: 'SS-4 Data Summary Sheet',
                        subheading: entityFullName,
                        meta: [
                            `Responsible Party: ${data.members[0].name || 'Primary Contact'}`,
                            `Closing Month: ${data.fiscalYear}`,
                            `Prepared: ${today}`
                        ],
                        sections: [
                            {
                                title: 'Entity Profile',
                                body: `Legal Name: ${entityFullName}<br>Entity Type: ${isLLC ? 'Limited Liability Company' : 'Corporation'}<br>State: ${data.state}<br>Start Date: ${today}`
                            },
                            {
                                title: 'Responsible Party',
                                body: `Name: ${data.members[0].name || '[COLLECT]'}<br>SSN/ITIN: [COLLECT SECURELY OFFLINE]<br>Physical Address: ${data.agentAddress}`
                            },
                            {
                                title: 'Reason for Applying',
                                body: 'Started a new business requiring a federal Employer Identification Number.'
                            }
                        ],
                        signatures: [
                            'Authorized Representative',
                            `Date: ${today}`
                        ]
                    });
                }

                case 'banking': {
                    return buildDocShell({
                        heading: 'Banking Resolution',
                        subheading: `Authority to Open Account — ${entityFullName}`,
                        meta: [
                            `Depository: ${data.bank}`,
                            `Authorization: ${data.management}`,
                            `Prepared: ${today}`
                        ],
                        sections: [
                            {
                                title: 'Designation of Depository',
                                body: `${data.bank} is hereby designated as a depository for the funds of ${entityFullName}.`
                            },
                            {
                                title: 'Authorized Signers',
                                body: `The following individuals are authorized to execute checks, drafts, or other orders for the payment of money:<br>${data.members.map(m => `<div>${m.name}</div>`).join('')}`
                            },
                            {
                                title: 'Certification',
                                body: `The undersigned certifies that these resolutions were duly adopted and remain in full force and effect as of ${today}.`
                            }
                        ],
                        signatures: [
                            'Organizer / Secretary',
                            'Bank Officer Witness'
                        ]
                    });
                }
            }
        }

        // --- UI Logic ---
        function setPreview(type) {
            state.currentDoc = type;
            
            // Update active button state
            document.querySelectorAll('.preview-tab').forEach(b => {
                b.classList.remove('bg-slate-700', 'text-white');
                b.classList.add('text-slate-400');
            });
            const activeBtn = document.getElementById(`btn-${type}`);
            activeBtn.classList.add('bg-slate-700', 'text-white');
            activeBtn.classList.remove('text-slate-400');

            updatePreview();
        }

        function updatePreview() {
            const data = getFormData();
            const html = generateDoc(state.currentDoc, data);
            document.getElementById('docPreviewCanvas').innerHTML = html;
            
            // Auto-save logic
            localStorage.setItem('entity_engine_data', JSON.stringify(data));
            document.getElementById('statusIndicator').innerText = "SAVED: " + new Date().toLocaleTimeString();
            document.getElementById('statusIndicator').classList.add('text-green-500');
            setTimeout(() => document.getElementById('statusIndicator').classList.remove('text-green-500'), 1000);
        }

        function switchTab(tab, btn) {
            // Simple tab logic if we add config later
            if (tab === 'input') {
                document.getElementById('entityForm').style.display = 'block';
            } else {
                alert("Configuration module not loaded in v1.0");
            }
        }

        function resetForm() {
            if(confirm("Clear all data?")) {
                localStorage.removeItem('entity_engine_data');
                location.reload();
            }
        }

        function loadLocal() {
            const saved = localStorage.getItem('entity_engine_data');
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('entityType').value = data.type;
                document.getElementById('state').value = data.state;
                document.getElementById('entityName').value = data.name;
                document.getElementById('agentName').value = data.agentName;
                document.getElementById('agentAddress').value = data.agentAddress;
                document.getElementById('bankName').value = data.bank;
                document.getElementById('capital').value = data.capital;
                
                // Rebuild members
                const container = document.getElementById('membersContainer');
                container.innerHTML = '';
                data.members.forEach(m => {
                    const div = document.createElement('div');
                    div.className = "flex gap-2 items-center";
                    div.innerHTML = `
                        <input type="text" class="input-field member-name" value="${m.name}" placeholder="Name" oninput="updatePreview()">
                        <input type="text" class="input-field w-24 member-percent" value="${m.percent}" placeholder="%" oninput="updatePreview()">
                        <button type="button" onclick="this.parentElement.remove(); updatePreview()" class="text-slate-400 hover:text-red-500 px-2">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    `;
                    container.appendChild(div);
                });
            }
        }

        const exportStyles = `
            @import url('https://fonts.googleapis.com/css2?family=Source+Serif+4:wght@400;500;600&family=Cormorant+Garamond:wght@600;700&display=swap');
            body { font-family: 'Source Serif 4', serif; line-height: 1.7; color: #1f2937; padding: 3rem 3.5rem; background: #fdfaf5; max-width: 900px; margin: 0 auto; border: 1px solid #e2dcc8; box-shadow: 0 12px 30px rgba(0,0,0,0.12); }
            .doc-body { position: relative; }
            .watermark { position: absolute; inset: 0; display: grid; place-items: center; pointer-events: none; opacity: 0.05; font-family: 'Cormorant Garamond', serif; font-size: 4.5rem; letter-spacing: 0.2em; color: #bfa76a; transform: rotate(-18deg); }
            .letterhead { display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; padding-bottom: 0.75rem; border-bottom: 2px solid #d7c7a3; }
            .letterhead-logo { display: flex; align-items: center; gap: 0.75rem; }
            .logo-mark { width: 44px; height: 44px; border: 2px solid #bfa76a; border-radius: 9999px; display: grid; place-items: center; font-family: 'Cormorant Garamond', serif; font-weight: 700; color: #bfa76a; letter-spacing: 0.08em; }
            .letterhead-title { font-family: 'Cormorant Garamond', serif; font-size: 1.25rem; letter-spacing: 0.05em; }
            .letterhead-subtitle { font-size: 0.9rem; color: #6b7280; letter-spacing: 0.08em; text-transform: uppercase; }
            .letterhead-meta { text-align: right; font-size: 0.85rem; color: #6b7280; line-height: 1.4; }
            .doc-heading { font-family: 'Cormorant Garamond', serif; font-size: 1.75rem; text-align: center; letter-spacing: 0.08em; text-transform: uppercase; margin: 1rem 0 0.5rem; }
            .doc-subheading { font-size: 0.95rem; text-align: center; letter-spacing: 0.15em; text-transform: uppercase; color: #6b7280; margin-bottom: 1.25rem; }
            .divider { border-bottom: 1px solid #d7c7a3; margin: 0.75rem 0 1.5rem; }
            .section-list { counter-reset: section; display: grid; gap: 1.2rem; }
            .numbered-section { counter-increment: section; padding-left: 2.25rem; position: relative; }
            .numbered-section::before { content: counter(section) '.'; position: absolute; left: 0; top: 0.2rem; font-family: 'Cormorant Garamond', serif; font-size: 1.15rem; font-weight: 700; color: #bfa76a; }
            .section-title { font-family: 'Cormorant Garamond', serif; font-size: 1.05rem; letter-spacing: 0.04em; text-transform: uppercase; margin-bottom: 0.35rem; }
            .section-body { font-size: 0.98rem; color: #1f2937; }
            .signature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.25rem; margin-top: 1.75rem; }
            .signature-line { border-top: 1px solid #c4b58f; padding-top: 0.55rem; font-size: 0.9rem; letter-spacing: 0.08em; text-transform: uppercase; color: #374151; }
        `;

        // --- Download Logic ---
        function downloadAll() {
            const data = getFormData();
            const zip = new JSZip();
            const folderName = data.name.replace(/[^a-z0-9]/gi, '_').toLowerCase() || 'entity_docs';
            const folder = zip.folder(folderName);

            // Generate contents
            const docs = ['articles', 'bylaws', 'ein', 'banking'];
            const names = {
                'articles': `1_Articles_of_${data.type === 'LLC' ? 'Organization' : 'Incorporation'}.html`,
                'bylaws': `2_${data.type === 'LLC' ? 'Operating_Agreement' : 'Bylaws'}.html`,
                'ein': `3_SS4_Info_Sheet.html`,
                'banking': `4_Banking_Resolution.html`
            };

            docs.forEach(docType => {
                const content = `
                    <html>
                    <head>
                        <style>${exportStyles}</style>
                    </head>
                    <body>${generateDoc(docType, data)}</body>
                    </html>
                `;
                folder.file(names[docType], content);
            });

            // Generate ZIP
            zip.generateAsync({type:"blob"}).then(function(content) {
                saveAs(content, `${folderName}_formation_kit.zip`);
            });
        }
    </script>
</body>
</html>
